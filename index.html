<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Preconnect to API -->
    <link rel="preconnect" href="https://api.aladhan.com" crossorigin>

    <!-- SEO Meta Tags -->
    <title>Jadwal Sholat Real-time - Waktu Sholat Akurat Berdasarkan Lokasi Anda</title>
    <meta name="description" content="Jadwal waktu sholat real-time dan akurat berdasarkan lokasi Anda. Lihat jam sholat Subuh, Dzuhur, Ashar, Maghrib, dan Isya dengan countdown otomatis. Prayer times Indonesia.">
    <meta name="keywords" content="jadwal sholat, waktu sholat, jam sholat, prayer time, solat time, waktu solat, jam solat, sholat indonesia, jadwal shalat, waktu shalat, jadwal solat, prayer times, islamic prayer times, waktu adzan, jadwal adzan">

    <style>
        :root {
            color-scheme: light;
        }

        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #ecfdf5 0%, #f1fdf8 45%, #e0f2fe 100%);
            padding: clamp(1rem, 4vw, 2.5rem) clamp(0.75rem, 5vw, 2rem);
            display: flex;
            justify-content: center;
            overflow-x: hidden;
            overflow-y: auto;
        }

        .container {
            width: min(100%, 32rem);
            margin: 0 auto;
            display: flex;
            flex-direction: column;
            gap: clamp(0.85rem, 2.5vw, 1.5rem);
        }

        .card {
            background: rgba(255, 255, 255, 0.98);
            border-radius: clamp(0.9rem, 2.5vw, 1.4rem);
            padding: clamp(1.1rem, 3.5vw, 1.7rem);
            box-shadow: 0 16px 32px rgba(15, 118, 110, 0.08);
            border: 1px solid rgba(16, 185, 129, 0.2);
        }

        .header {
            text-align: center;
            display: flex;
            flex-direction: column;
            gap: 0.4rem;
        }

        #date {
            color: #0f172a;
            font-size: clamp(0.95rem, 2.6vw, 1.05rem);
            font-weight: 500;
        }

        #clock {
            color: #022c22;
            font-size: clamp(2.6rem, 9vw, 3.2rem);
            font-weight: 700;
            font-family: 'Courier New', monospace;
            letter-spacing: 0.05em;
        }

        #location {
            color: #047857;
            font-weight: 600;
            font-size: clamp(0.95rem, 2.8vw, 1.1rem);
        }

        .countdown {
            background: linear-gradient(135deg, #047857, #10b981);
            color: #f0fdfa;
            border-radius: clamp(0.9rem, 2.5vw, 1.4rem);
            padding: clamp(1.1rem, 3.5vw, 1.6rem);
            text-align: center;
            box-shadow: 0 12px 24px rgba(15, 118, 110, 0.2);
        }

        .countdown-text {
            font-weight: 500;
            font-size: clamp(0.95rem, 2.8vw, 1.05rem);
            letter-spacing: 0.03em;
        }

        .loading {
            text-align: center;
            padding: 3.5rem 0;
            display: flex;
            flex-direction: column;
            align-items: center;
            gap: 1rem;
            color: #0f172a;
        }

        .spinner {
            display: inline-block;
            width: 3rem;
            height: 3rem;
            border: 4px solid #d1fae5;
            border-top-color: #059669;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-text {
            color: #64748b;
            font-weight: 500;
            font-size: clamp(1rem, 3vw, 1.1rem);
        }

        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: clamp(0.9rem, 2.5vw, 1.3rem);
            padding: clamp(1.25rem, 3.5vw, 1.75rem);
            text-align: center;
            box-shadow: 0 12px 20px rgba(248, 113, 113, 0.15);
        }

        .error-text {
            color: #b91c1c;
            margin-bottom: 1rem;
            font-weight: 500;
            font-size: clamp(1rem, 3vw, 1.1rem);
        }

        .btn-retry {
            background: #dc2626;
            color: white;
            padding: 0.75rem 1.5rem;
            border-radius: 999px;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s ease, transform 0.2s ease;
            font-size: clamp(0.95rem, 2.8vw, 1.05rem);
        }

        .btn-retry:hover {
            background: #b91c1c;
            transform: translateY(-1px);
        }

        .btn-retry:active {
            transform: translateY(0);
        }

        .prayer-list {
            display: flex;
            flex-direction: column;
            gap: clamp(0.8rem, 2.5vw, 1.35rem);
        }

        .prayer-item {
            background: rgba(255, 255, 255, 0.98);
            border: 2px solid rgba(16, 185, 129, 0.4);
            border-radius: clamp(0.85rem, 2.5vw, 1.3rem);
            padding: clamp(0.95rem, 3vw, 1.35rem);
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 10px 18px rgba(15, 118, 110, 0.08);
            gap: 0.75rem;
        }

        .prayer-item.active {
            background: #10b981;
            border-color: #10b981;
            color: #f8fafc;
        }

        .prayer-name-wrapper {
            display: flex;
            align-items: center;
            gap: clamp(0.5rem, 2vw, 0.8rem);
        }

        .prayer-icon {
            font-size: clamp(1.2rem, 4vw, 1.6rem);
            line-height: 1;
        }

        .prayer-name {
            font-weight: 700;
            font-size: clamp(1.05rem, 3.2vw, 1.25rem);
            color: #064e3b;
            letter-spacing: 0.05em;
            text-transform: uppercase;
        }

        .prayer-item.active .prayer-name {
            color: inherit;
        }

        .prayer-time {
            font-family: 'Courier New', monospace;
            font-size: clamp(1.1rem, 3.5vw, 1.4rem);
            font-weight: 700;
            color: #0f172a;
        }

        .prayer-item.active .prayer-time {
            color: inherit;
        }

        .footer {
            margin-top: clamp(0.5rem, 2.5vw, 1.5rem);
            text-align: center;
            color: #64748b;
            font-size: clamp(0.85rem, 2.5vw, 0.95rem);
        }

        .hidden { display: none !important; }

        @media (min-width: 640px) {
            body {
                padding: clamp(1.75rem, 5vw, 2.5rem) clamp(1.5rem, 5vw, 2.75rem);
            }

            .container {
                width: min(100%, 34rem);
                gap: 1.35rem;
            }

            .card,
            .countdown {
                border-radius: 1.35rem;
            }

            .countdown {
                padding: 1.45rem;
            }

            .prayer-item {
                border-radius: 1.35rem;
                padding: 1.25rem 1.5rem;
            }

            .prayer-list {
                gap: 1.25rem;
            }
        }

        @media (min-width: 1024px) {
            body {
                padding: 2rem 0 2.5rem;
            }

            .container {
                width: min(100%, 28rem);
                gap: 1rem;
            }

            .card,
            .countdown {
                border-radius: 1.1rem;
                padding: 1.1rem 1.5rem;
                box-shadow: 0 12px 24px rgba(15, 118, 110, 0.12);
            }

            #date {
                font-size: 0.95rem;
            }

            #clock {
                font-size: 2.8rem;
            }

            #location {
                font-size: 0.95rem;
            }

            .countdown {
                padding: 1.1rem 1.5rem;
            }

            .countdown-text {
                font-size: 0.95rem;
            }

            .prayer-list {
                gap: 1rem;
            }

            .prayer-item {
                border-radius: 1.1rem;
                padding: 0.9rem 1.35rem;
                box-shadow: 0 10px 18px rgba(15, 118, 110, 0.08);
            }

            .prayer-name {
                font-size: 1rem;
            }

            .prayer-time {
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- Header with Clock -->
        <div class="card header">
            <div id="date"></div>
            <div id="clock">--:--:--</div>
            <div id="location"></div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div class="loading-text">Memuat jadwal sholat...</div>
        </div>

        <!-- Error -->
        <div id="error" class="error hidden">
            <div id="error-text" class="error-text"></div>
            <button onclick="location.reload()" class="btn-retry">Coba Lagi</button>
        </div>

        <!-- Prayer Times -->
        <div id="prayer-times" class="prayer-list hidden"></div>
    </div>

    <script>
        // Prayer names mapping
        const prayerNames = {
            imsak: 'Imsak',
            fajr: 'Subuh',
            syuruq: 'Terbit',
            dhuhr: 'Dzuhur',
            asr: 'Ashar',
            maghrib: 'Maghrib',
            isha: 'Isya'
        };

        // Prayer icons
        const prayerIcons = {
            imsak: 'üåô',
            fajr: '‚òÄÔ∏è',
            syuruq: 'üåÖ',
            dhuhr: '‚òÄÔ∏è',
            asr: '‚òÄÔ∏è',
            maghrib: 'üåÜ',
            isha: 'üåô'
        };

        const mainPrayers = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];
        const allPrayers = ['imsak', 'fajr', 'syuruq', 'dhuhr', 'asr', 'maghrib', 'isha'];

        let prayerTimesData = null;

        // Update clock
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;

            const dateStr = now.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('date').textContent = dateStr;

            // Update countdown
            updateCountdown();
        }

        // Update countdown
        function updateCountdown() {
            if (!prayerTimesData) return;

            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();
            const countdownEl = document.getElementById('countdown');
            const wasHidden = countdownEl.classList.contains('hidden');

            for (const prayer of mainPrayers) {
                const timeStr = prayerTimesData[prayer];
                const [hours, minutes] = timeStr.split(':').map(Number);
                const prayerMinutes = hours * 60 + minutes;

                let diff = prayerMinutes - currentMinutes;
                if (diff < 0) diff += 24 * 60;

                if (diff > 0 && diff <= 30) {
                    countdownEl.classList.remove('hidden');
                    document.getElementById('countdown-text').textContent =
                        `${diff} menit lagi masuk waktu shalat ${prayerNames[prayer]}`;
                    return;
                }
            }

            countdownEl.classList.add('hidden');
        }

        // Get location
        async function getLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation tidak didukung browser'));
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    position => resolve({
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    }),
                    error => reject(new Error('Gagal mendapatkan lokasi. Pastikan GPS aktif.')),
                    { enableHighAccuracy: false, timeout: 5000, maximumAge: 600000 }
                );
            });
        }

        // Get city name
        async function getCityName(lat, lng) {
            try {
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 3000);

                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=10&addressdetails=1&accept-language=id`,
                    { signal: controller.signal }
                );

                clearTimeout(timeout);

                if (!response.ok) throw new Error('Failed');

                const data = await response.json();
                const addr = data.address || {};

                return addr.city || addr.town || addr.county || addr.state || 'Indonesia';
            } catch (error) {
                return 'Indonesia';
            }
        }

        // Fetch prayer times
        async function fetchPrayerTimes(lat, lng) {
            const date = new Date();
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();

            try {
                const dateStr = `${day}-${month}-${year}`;
                const url = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${lat}&longitude=${lng}&method=20`;

                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 10000);

                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeout);

                if (!response.ok) {
                    throw new Error('Layanan jadwal sholat sedang tidak tersedia. Silakan coba lagi nanti.');
                }

                const data = await response.json();
                const t = data.data.timings;

                return {
                    imsak: t.Imsak.substring(0, 5),
                    fajr: t.Fajr.substring(0, 5),
                    syuruq: t.Sunrise.substring(0, 5),
                    dhuhr: t.Dhuhr.substring(0, 5),
                    asr: t.Asr.substring(0, 5),
                    maghrib: t.Maghrib.substring(0, 5),
                    isha: t.Isha.substring(0, 5)
                };
            } catch (error) {
                if (error.name === 'AbortError') {
                    throw new Error('Koneksi timeout. Periksa koneksi internet Anda.');
                }
                throw new Error(error.message || 'Layanan jadwal sholat sedang tidak tersedia. Silakan coba lagi nanti.');
            }
        }

        // Display prayer times
        function displayPrayerTimes(times) {
            const container = document.getElementById('prayer-times');
            container.innerHTML = '';

            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();

            allPrayers.forEach(prayer => {
                const isMain = mainPrayers.includes(prayer);
                const div = document.createElement('div');
                div.className = 'prayer-item';

                // Find next prayer for active state
                const timeStr = times[prayer];
                const [hours, minutes] = timeStr.split(':').map(Number);
                const prayerMinutes = hours * 60 + minutes;
                let nextPrayerMinutes = Infinity;
                for (const p of mainPrayers) {
                    const [h, m] = times[p].split(':').map(Number);
                    const pm = h * 60 + m;
                    if (pm > currentMinutes && pm < nextPrayerMinutes) {
                        nextPrayerMinutes = pm;
                    }
                }

                if (prayerMinutes === nextPrayerMinutes) {
                    div.classList.add('active');
                }

                div.innerHTML = `
                    <div class="prayer-name-wrapper">
                        <span class="prayer-icon">${prayerIcons[prayer]}</span>
                        <span class="prayer-name">${prayerNames[prayer]}</span>
                    </div>
                    <span class="prayer-time">
                        ${times[prayer]}
                    </span>
                `;
                container.appendChild(div);
            });

            container.classList.remove('hidden');
        }

        // Initialize app
        async function init() {
            try {
                // Start clock immediately
                updateClock();
                setInterval(updateClock, 1000);

                // Get location
                const { lat, lng } = await getLocation();

                // Get city name (non-blocking)
                getCityName(lat, lng).then(city => {
                    document.getElementById('location').textContent = city;
                });

                // Fetch prayer times
                const times = await fetchPrayerTimes(lat, lng);
                prayerTimesData = times;

                // Display
                displayPrayerTimes(times);

                // Hide loading
                document.getElementById('loading').classList.add('hidden');

            } catch (error) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-text').textContent = error.message;
            }
        }

        // Start app
        init();
    </script>
</body>
</html>
