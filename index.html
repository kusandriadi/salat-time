<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">

    <!-- Preconnect to API -->
    <link rel="preconnect" href="https://api.aladhan.com" crossorigin>

    <!-- SEO Meta Tags -->
    <title>Jadwal Sholat Real-time - Waktu Sholat Akurat Berdasarkan Lokasi Anda</title>
    <meta name="description" content="Jadwal waktu sholat real-time dan akurat berdasarkan lokasi Anda. Lihat jam sholat Subuh, Dzuhur, Ashar, Maghrib, dan Isya dengan countdown otomatis. Prayer times Indonesia.">
    <meta name="keywords" content="jadwal sholat, waktu sholat, jam sholat, prayer time, solat time, waktu solat, jam solat, sholat indonesia, jadwal shalat, waktu shalat, jadwal solat, prayer times, islamic prayer times, waktu adzan, jadwal adzan">

    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, Arial, sans-serif;
            min-height: 100vh;
            background: linear-gradient(135deg, #ecfdf5 0%, #f0fdfa 50%, #ecfeff 100%);
            padding: 1rem;
        }

        .container { max-width: 48rem; margin: 0 auto; }

        .card {
            background: white;
            border-radius: 1rem;
            padding: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
            border: 1px solid #d1fae5;
            margin-bottom: 1.5rem;
        }

        .header { text-align: center; }

        #date { color: #64748b; font-size: 0.75rem; font-weight: 500; margin-bottom: 0.25rem; }
        #clock { color: #1e293b; font-size: 2rem; font-weight: bold; font-family: 'Courier New', monospace; letter-spacing: 0.05em; }
        #location { margin-top: 0.5rem; color: #047857; font-weight: 600; font-size: 0.875rem; }

        .countdown {
            background: #059669;
            color: white;
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
            margin-bottom: 1rem;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .countdown-text { font-weight: 500; font-size: 0.875rem; }
        .loading { text-align: center; padding: 3rem 0; }

        .spinner {
            display: inline-block;
            width: 2.5rem;
            height: 2.5rem;
            border: 4px solid #d1fae5;
            border-top-color: #059669;
            border-radius: 50%;
            animation: spin 1s linear infinite;
        }

        @keyframes spin { to { transform: rotate(360deg); } }

        .loading-text { color: #64748b; margin-top: 1rem; font-weight: 500; font-size: 0.875rem; }

        .error {
            background: #fef2f2;
            border: 1px solid #fecaca;
            border-radius: 1rem;
            padding: 1rem;
            text-align: center;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        .error-text { color: #b91c1c; margin-bottom: 1rem; font-weight: 500; font-size: 0.875rem; }

        .btn-retry {
            background: #dc2626;
            color: white;
            padding: 0.625rem 1.25rem;
            border-radius: 0.75rem;
            border: none;
            font-weight: 600;
            cursor: pointer;
            transition: background 0.2s;
            font-size: 0.875rem;
        }

        .btn-retry:hover { background: #b91c1c; }

        .prayer-list { display: flex; flex-direction: column; gap: 0.5rem; }

        .prayer-item {
            background: white;
            border: 1px solid #d1fae5;
            border-radius: 1rem;
            padding: 1rem;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 4px rgba(0,0,0,0.05);
            transition: box-shadow 0.3s;
        }

        .prayer-item:hover { box-shadow: 0 4px 12px rgba(0,0,0,0.1); }
        .prayer-name { font-weight: 600; font-size: 1rem; }
        .prayer-name.main { color: #334155; }
        .prayer-name.additional { color: #64748b; }

        .prayer-time {
            font-family: 'Courier New', monospace;
            font-size: 1.25rem;
            font-weight: bold;
            color: #047857;
            letter-spacing: 0.05em;
        }

        .footer { margin-top: 1.5rem; text-align: center; color: #64748b; font-size: 0.75rem; }
        .hidden { display: none !important; }

        /* Tablet >= 640px */
        @media (min-width: 640px) {
            body { padding: 1.5rem; }
            .card { padding: 1.5rem; border-radius: 1.5rem; margin-bottom: 2rem; }
            #date { font-size: 0.875rem; }
            #clock { font-size: 2.5rem; }
            #location { margin-top: 0.75rem; font-size: 1rem; }
            .countdown { padding: 1.25rem; border-radius: 1.5rem; margin-bottom: 1.5rem; }
            .countdown-text { font-size: 1rem; }
            .spinner { width: 3rem; height: 3rem; }
            .loading-text { font-size: 1rem; }
            .error { padding: 1.5rem; border-radius: 1.5rem; }
            .error-text { font-size: 1rem; }
            .btn-retry { padding: 0.75rem 1.5rem; border-radius: 1rem; font-size: 1rem; }
            .prayer-list { gap: 0.75rem; }
            .prayer-item { padding: 1.25rem; border-radius: 1.5rem; }
            .prayer-name { font-size: 1.125rem; }
            .prayer-time { font-size: 1.5rem; }
            .footer { font-size: 0.875rem; }
        }

        /* Desktop >= 768px */
        @media (min-width: 768px) {
            body { padding: 2rem; }
            #clock { font-size: 3rem; }
            .prayer-name { font-size: 1.25rem; }
            .prayer-time { font-size: 1.75rem; }
        }

        /* Large Desktop >= 1024px */
        @media (min-width: 1024px) {
            #clock { font-size: 3.5rem; }
            .prayer-time { font-size: 2rem; }
        }
    </style>
</head>
<body>
    <div class="container">

        <!-- Header with Clock -->
        <div class="card header">
            <div id="date"></div>
            <div id="clock">--:--:--</div>
            <div id="location"></div>
        </div>

        <!-- Countdown Alert -->
        <div id="countdown" class="countdown hidden">
            <div id="countdown-text" class="countdown-text"></div>
        </div>

        <!-- Loading -->
        <div id="loading" class="loading">
            <div class="spinner"></div>
            <div class="loading-text">Memuat jadwal sholat...</div>
        </div>

        <!-- Error -->
        <div id="error" class="error hidden">
            <div id="error-text" class="error-text"></div>
            <button onclick="location.reload()" class="btn-retry">Coba Lagi</button>
        </div>

        <!-- Prayer Times -->
        <div id="prayer-times" class="prayer-list hidden"></div>

        <!-- Footer -->
        <div class="footer">
            <p>Jadwal sholat diperbarui secara otomatis</p>
        </div>
    </div>

    <script>
        // Prayer names mapping
        const prayerNames = {
            imsak: 'Imsak',
            fajr: 'Subuh',
            syuruq: 'Syuruq',
            dhuhr: 'Dzuhur',
            asr: 'Ashar',
            maghrib: 'Maghrib',
            isha: 'Isya'
        };

        const mainPrayers = ['fajr', 'dhuhr', 'asr', 'maghrib', 'isha'];
        const allPrayers = ['imsak', 'fajr', 'syuruq', 'dhuhr', 'asr', 'maghrib', 'isha'];

        let prayerTimesData = null;

        // Update clock
        function updateClock() {
            const now = new Date();
            const hours = String(now.getHours()).padStart(2, '0');
            const minutes = String(now.getMinutes()).padStart(2, '0');
            const seconds = String(now.getSeconds()).padStart(2, '0');

            document.getElementById('clock').textContent = `${hours}:${minutes}:${seconds}`;

            const dateStr = now.toLocaleDateString('id-ID', {
                weekday: 'long',
                year: 'numeric',
                month: 'long',
                day: 'numeric'
            });
            document.getElementById('date').textContent = dateStr;

            // Update countdown
            updateCountdown();
        }

        // Update countdown
        function updateCountdown() {
            if (!prayerTimesData) return;

            const now = new Date();
            const currentMinutes = now.getHours() * 60 + now.getMinutes();

            for (const prayer of mainPrayers) {
                const timeStr = prayerTimesData[prayer];
                const [hours, minutes] = timeStr.split(':').map(Number);
                const prayerMinutes = hours * 60 + minutes;

                let diff = prayerMinutes - currentMinutes;
                if (diff < 0) diff += 24 * 60;

                if (diff > 0 && diff <= 30) {
                    document.getElementById('countdown').classList.remove('hidden');
                    document.getElementById('countdown-text').textContent =
                        `${diff} menit lagi masuk waktu shalat ${prayerNames[prayer]}`;
                    return;
                }
            }

            document.getElementById('countdown').classList.add('hidden');
        }

        // Get location
        async function getLocation() {
            return new Promise((resolve, reject) => {
                if (!navigator.geolocation) {
                    reject(new Error('Geolocation tidak didukung browser'));
                    return;
                }

                navigator.geolocation.getCurrentPosition(
                    position => resolve({
                        lat: position.coords.latitude,
                        lng: position.coords.longitude
                    }),
                    error => reject(new Error('Gagal mendapatkan lokasi. Pastikan GPS aktif.')),
                    { enableHighAccuracy: false, timeout: 5000, maximumAge: 600000 }
                );
            });
        }

        // Get city name
        async function getCityName(lat, lng) {
            try {
                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 3000);

                const response = await fetch(
                    `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lng}&zoom=10&addressdetails=1&accept-language=id`,
                    { signal: controller.signal }
                );

                clearTimeout(timeout);

                if (!response.ok) throw new Error('Failed');

                const data = await response.json();
                const addr = data.address || {};

                return addr.city || addr.town || addr.county || addr.state || 'Indonesia';
            } catch (error) {
                return 'Indonesia';
            }
        }

        // Fetch prayer times
        async function fetchPrayerTimes(lat, lng) {
            const date = new Date();
            const day = String(date.getDate()).padStart(2, '0');
            const month = String(date.getMonth() + 1).padStart(2, '0');
            const year = date.getFullYear();

            try {
                const dateStr = `${day}-${month}-${year}`;
                const url = `https://api.aladhan.com/v1/timings/${dateStr}?latitude=${lat}&longitude=${lng}&method=20`;

                const controller = new AbortController();
                const timeout = setTimeout(() => controller.abort(), 10000);

                const response = await fetch(url, { signal: controller.signal });
                clearTimeout(timeout);

                if (!response.ok) {
                    throw new Error('Layanan jadwal sholat sedang tidak tersedia. Silakan coba lagi nanti.');
                }

                const data = await response.json();
                const t = data.data.timings;

                return {
                    imsak: t.Imsak.substring(0, 5),
                    fajr: t.Fajr.substring(0, 5),
                    syuruq: t.Sunrise.substring(0, 5),
                    dhuhr: t.Dhuhr.substring(0, 5),
                    asr: t.Asr.substring(0, 5),
                    maghrib: t.Maghrib.substring(0, 5),
                    isha: t.Isha.substring(0, 5)
                };
            } catch (error) {
                if (error.name === 'AbortError') {
                    throw new Error('Koneksi timeout. Periksa koneksi internet Anda.');
                }
                throw new Error(error.message || 'Layanan jadwal sholat sedang tidak tersedia. Silakan coba lagi nanti.');
            }
        }

        // Display prayer times
        function displayPrayerTimes(times) {
            const container = document.getElementById('prayer-times');
            container.innerHTML = '';

            allPrayers.forEach(prayer => {
                const isMain = mainPrayers.includes(prayer);
                const div = document.createElement('div');
                div.className = 'prayer-item';
                div.innerHTML = `
                    <span class="prayer-name ${isMain ? 'main' : 'additional'}">
                        ${prayerNames[prayer]}
                    </span>
                    <span class="prayer-time">
                        ${times[prayer]}
                    </span>
                `;
                container.appendChild(div);
            });

            container.classList.remove('hidden');
        }

        // Initialize app
        async function init() {
            try {
                // Start clock immediately
                updateClock();
                setInterval(updateClock, 1000);

                // Get location
                const { lat, lng } = await getLocation();

                // Get city name (non-blocking)
                getCityName(lat, lng).then(city => {
                    document.getElementById('location').textContent = city;
                });

                // Fetch prayer times
                const times = await fetchPrayerTimes(lat, lng);
                prayerTimesData = times;

                // Display
                displayPrayerTimes(times);

                // Hide loading
                document.getElementById('loading').classList.add('hidden');

            } catch (error) {
                document.getElementById('loading').classList.add('hidden');
                document.getElementById('error').classList.remove('hidden');
                document.getElementById('error-text').textContent = error.message;
            }
        }

        // Start app
        init();
    </script>
</body>
</html>
